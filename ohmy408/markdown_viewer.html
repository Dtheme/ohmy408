<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Markdown + LaTeX é˜…è¯»å™¨</title>
                <!-- å¼•å…¥ Marked.js -->
                <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
                <!-- å¼•å…¥ MathJax é…ç½® -->
                <script>
                    window.MathJax = {
                        tex: {
                            inlineMath: [['$', '$'], ['\\(', '\\)']],     // è¡Œå†…å…¬å¼åˆ†éš”ç¬¦
                            displayMath: [['$$', '$$'], ['\\[', '\\]']], // å—çº§å…¬å¼åˆ†éš”ç¬¦
                            processEscapes: true,                        // æ”¯æŒåæ–œæ è½¬ä¹‰
                            processEnvironments: true,                   // æ”¯æŒç¯å¢ƒ
                            packages: {
                                '[+]': ['base', 'ams', 'amssymb', 'boldsymbol', 'physics', 'mhchem', 'newcommand', 'configmacros']
                            },
                            tags: 'ams',                                 // å…¬å¼ç¼–å·
                            tagSide: 'right',                           // ç¼–å·ä½ç½®
                            tagIndent: '0.8em'                          // ç¼–å·ç¼©è¿›
                        },
                        chtml: {
                            scale: 1.1,                                 // å…¬å¼ç¼©æ”¾
                            minScale: 0.5,                              // æœ€å°ç¼©æ”¾
                            matchFontHeight: false,                     // åŒ¹é…å­—ä½“é«˜åº¦
                            displayAlign: 'center',                     // å±…ä¸­å¯¹é½
                            displayIndent: '0em'                        // æ˜¾ç¤ºç¼©è¿›
                        },
                        startup: {
                            typeset: false                              // ç¦æ­¢è‡ªåŠ¨åˆå§‹åŒ–ï¼Œæ‰‹åŠ¨æ§åˆ¶æ¸²æŸ“
                        },
                        loader: {
                            load: ['[tex]/mhchem', '[tex]/physics', '[tex]/configmacros']
                        }
                    };
                </script>
                <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
                <style>
                    body {
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
                        line-height: 1.6;
                        color: #333;
                        max-width: 100%;
                        margin: 0;
                        padding: 20px;
                        box-sizing: border-box;
                    }
                    
                    #rendered-content {
                        max-width: 100%;
                        margin: 0 auto;
                    }
                    
                    /* æ ‡é¢˜æ ·å¼ */
                    h1, h2, h3, h4, h5, h6 {
                        margin-top: 1.5em;
                        margin-bottom: 0.5em;
                        font-weight: 600;
                        line-height: 1.25;
                    }
                    
                    h1 { font-size: 2em; border-bottom: 1px solid #eee; padding-bottom: 0.3em; }
                    h2 { font-size: 1.5em; border-bottom: 1px solid #eee; padding-bottom: 0.3em; }
                    h3 { font-size: 1.25em; }
                    h4 { font-size: 1em; }
                    h5 { font-size: 0.875em; }
                    h6 { font-size: 0.85em; color: #666; }
                    
                    /* æ®µè½æ ·å¼ */
                    p {
                        margin-bottom: 1em;
                    }
                    
                    /* ä»£ç æ ·å¼ */
                    code {
                        background-color: #f6f8fa;
                        border-radius: 3px;
                        font-size: 85%;
                        margin: 0;
                        padding: 2px 4px;
                        font-family: 'SF Mono', Monaco, Inconsolata, 'Roboto Mono', Consolas, 'Courier New', monospace;
                    }
                    
                    pre {
                        background-color: #f6f8fa;
                        border-radius: 6px;
                        font-size: 85%;
                        line-height: 1.45;
                        overflow: auto;
                        padding: 16px;
                        margin: 1em 0;
                    }
                    
                    pre code {
                        background-color: transparent;
                        border: 0;
                        display: inline;
                        line-height: inherit;
                        margin: 0;
                        overflow: visible;
                        padding: 0;
                        word-wrap: normal;
                    }
                    
                    /* å¼•ç”¨æ ·å¼ */
                    blockquote {
                        border-left: 4px solid #dfe2e5;
                        margin: 1em 0;
                        padding: 0 1em;
                        color: #6a737d;
                    }
                    
                    /* åˆ—è¡¨æ ·å¼ */
                    ul, ol {
                        margin-bottom: 1em;
                        padding-left: 2em;
                    }
                    
                    li {
                        margin-bottom: 0.25em;
                    }
                    
                    /* è¡¨æ ¼æ ·å¼ */
                    table {
                        border-collapse: collapse;
                        border-spacing: 0;
                        width: 100%;
                        margin: 1em 0;
                        overflow: auto;
                        display: block;
                        white-space: nowrap;
                    }
                    
                    table thead tr {
                        background-color: #f6f8fa;
                    }
                    
                    table th, table td {
                        border: 1px solid #dfe2e5;
                        padding: 6px 13px;
                        text-align: left;
                    }
                    
                    table th {
                        font-weight: 600;
                    }
                    
                    table tr:nth-child(2n) {
                        background-color: #f6f8fa;
                    }
                    
                    /* é“¾æ¥æ ·å¼ */
                    a {
                        color: #0366d6;
                        text-decoration: none;
                    }
                    
                    a:hover {
                        text-decoration: underline;
                    }
                    
                    /* åˆ†å‰²çº¿æ ·å¼ */
                    hr {
                        border: 0;
                        border-top: 1px solid #eee;
                        margin: 2em 0;
                    }
                    
                    /* å›¾ç‰‡æ ·å¼ */
                    img {
                        max-width: 100%;
                        height: auto;
                        border-radius: 4px;
                        margin: 0.5em 0;
                        cursor: zoom-in;
                        transition: transform 0.2s ease;
                    }
                    
                    img:hover {
                        transform: scale(1.02);
                    }
                    
                    /* MathJax å…¬å¼æ ·å¼ */
                    .MathJax {
                        font-size: 1.1em !important;
                    }
                    
                    .MathJax_Display {
                        margin: 1em 0 !important;
                    }
                    
                    /* å“åº”å¼è®¾è®¡ */
                    @media (max-width: 768px) {
                        body {
                            padding: 10px;
                            font-size: 14px;
                        }
                        
                        table {
                            font-size: 12px;
                        }
                    }
                    
                    /* æš—è‰²æ¨¡å¼æ”¯æŒ */
                    @media (prefers-color-scheme: dark) {
                        body:not(.light-mode) {
                            background-color: #0d1117;
                            color: #c9d1d9;
                        }
                        
                        body:not(.light-mode) h1, body:not(.light-mode) h2 {
                            border-bottom-color: #21262d;
                        }
                        
                        body:not(.light-mode) h6 {
                            color: #8b949e;
                        }
                        
                        body:not(.light-mode) code {
                            background-color: #161b22;
                            color: #e6edf3;
                        }
                        
                        body:not(.light-mode) pre {
                            background-color: #161b22;
                        }
                        
                        body:not(.light-mode) blockquote {
                            border-left-color: #3c434b;
                            color: #8b949e;
                        }
                        
                        body:not(.light-mode) table th, body:not(.light-mode) table td {
                            border-color: #30363d;
                        }
                        
                        body:not(.light-mode) table thead tr, body:not(.light-mode) table tr:nth-child(2n) {
                            background-color: #161b22;
                        }
                        
                        body:not(.light-mode) a {
                            color: #58a6ff;
                        }
                        
                        body:not(.light-mode) hr {
                            border-top-color: #21262d;
                        }
                        
                        /* ä»£ç å¤åˆ¶æŒ‰é’®è‡ªåŠ¨æš—è‰²æ¨¡å¼æ ·å¼ */
                        body:not(.light-mode) .code-copy-button {
                            background-color: #21262d !important;
                            color: #c9d1d9 !important;
                            border-color: #30363d !important;
                        }
                        
                        body:not(.light-mode) .code-copy-button:hover {
                            background-color: #30363d !important;
                        }
                        
                        body:not(.light-mode) #theme-toggle {
                            background-color: #21262d;
                            color: #c9d1d9;
                            border-color: #30363d;
                        }
                        
                        body:not(.light-mode) #theme-toggle:hover {
                            background-color: #30363d;
                        }
                    }
                    
                    /* æ‰‹åŠ¨æ·±è‰²æ¨¡å¼ */
                    body.dark-mode {
                        background-color: #0d1117;
                        color: #c9d1d9;
                    }
                    
                    body.dark-mode h1, body.dark-mode h2 {
                        border-bottom-color: #21262d;
                    }
                    
                    body.dark-mode h6 {
                        color: #8b949e;
                    }
                    
                    body.dark-mode code {
                        background-color: #161b22;
                        color: #e6edf3;
                    }
                    
                    body.dark-mode pre {
                        background-color: #161b22;
                    }
                    
                    body.dark-mode blockquote {
                        border-left-color: #3c434b;
                        color: #8b949e;
                    }
                    
                    body.dark-mode table th, body.dark-mode table td {
                        border-color: #30363d;
                    }
                    
                    body.dark-mode table thead tr, body.dark-mode table tr:nth-child(2n) {
                        background-color: #161b22;
                    }
                    
                    body.dark-mode a {
                        color: #58a6ff;
                    }
                    
                    body.dark-mode hr {
                        border-top-color: #21262d;
                    }
                    
                    body.dark-mode #theme-toggle {
                        background-color: #21262d;
                        color: #c9d1d9;
                        border-color: #30363d;
                    }
                    
                    body.dark-mode #theme-toggle:hover {
                        background-color: #30363d;
                    }
                    
                    /* æš—è‰²æ¨¡å¼ä¸‹çš„ç›®å½•æ ·å¼ */
                    body.dark-mode #toc-panel {
                        background-color: #161b22 !important;
                        border-right-color: #30363d !important;
                        color: #c9d1d9 !important;
                    }
                    
                    body.dark-mode #toc-toggle {
                        background-color: #21262d !important;
                        border-color: #30363d !important;
                        color: #c9d1d9 !important;
                    }
                    
                    body.dark-mode #toc-toggle:hover {
                        background-color: #30363d !important;
                    }
                    
                    /* ç›®å½•é“¾æ¥æ ·å¼ä¼˜åŒ– */
                    .toc-link:hover {
                        background-color: #f3f4f6 !important;
                        color: #0969da !important;
                    }
                    
                    body.dark-mode .toc-link:hover {
                        background-color: #30363d !important;
                        color: #58a6ff !important;
                    }
                    
                    /* ä»£ç å¤åˆ¶æŒ‰é’®æš—è‰²æ¨¡å¼æ ·å¼ */
                    body.dark-mode .code-copy-button {
                        background-color: #21262d !important;
                        color: #c9d1d9 !important;
                        border-color: #30363d !important;
                    }
                    
                    body.dark-mode .code-copy-button:hover {
                        background-color: #30363d !important;
                    }
                    
                    /* ç›®å½•é¢æ¿æ‰“å¼€çŠ¶æ€ */
                    #toc-panel.open {
                        left: 0 !important;
                    }
                    
                    /* å“åº”å¼è®¾è®¡ - ç§»åŠ¨ç«¯ä¼˜åŒ– */
                    @media (max-width: 480px) {
                        /* å°å±å¹•ï¼šç›®å½•é¢æ¿å…¨å± */
                        #toc-panel {
                            width: 100vw !important;
                            left: -100vw !important;
                        }
                        
                        #toc-panel.open {
                            left: 0 !important;
                        }
                    }
                    
                    @media (min-width: 481px) and (max-width: 768px) {
                        /* ä¸­ç­‰å±å¹•ï¼šç›®å½•é¢æ¿70% */
                        #toc-panel {
                            width: 70vw !important;
                            left: -70vw !important;
                        }
                        
                        #toc-panel.open {
                            left: 0 !important;
                        }
                    }
                    
                    @media (max-width: 768px) {
                        /* ç§»åŠ¨ç«¯æŒ‰é’®è°ƒæ•´ */
                        div[style*="left: 20px"] {
                            top: 10px !important;
                            left: 10px !important;
                        }
                        
                        div[style*="right: 20px"] {
                            top: 10px !important;
                            right: 10px !important;
                        }
                        
                        #toc-toggle, #theme-toggle {
                            padding: 6px 10px !important;
                            font-size: 12px !important;
                            -webkit-tap-highlight-color: transparent;
                            touch-action: manipulation;
                        }
                        
                        /* ä¼˜åŒ–ç›®å½•é¢æ¿å¤´éƒ¨ */
                        #toc-panel > div:first-child {
                            padding-top: 50px !important;
                        }
                    }
                    
                    /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’®æ ·å¼ */
                    #theme-toggle {
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background-color: #f6f8fa;
                        border: 1px solid #d0d7de;
                        border-radius: 6px;
                        padding: 8px 12px;
                        cursor: pointer;
                        font-size: 14px;
                        font-family: inherit;
                        transition: all 0.2s ease;
                        z-index: 1000;
                        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                    }
                    
                    #theme-toggle:hover {
                        background-color: #f3f4f6;
                        transform: translateY(-1px);
                        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
                    }
                    
                    #theme-toggle:active {
                        transform: translateY(0);
                    }
                    
                    /* å“åº”å¼è®¾è®¡ - ç§»åŠ¨ç«¯è°ƒæ•´æŒ‰é’®ä½ç½® */
                    @media (max-width: 768px) {
                        #theme-toggle {
                            top: 10px;
                            right: 10px;
                            padding: 6px 10px;
                            font-size: 12px;
                        }
                    }
                </style>
            </head>
    <body>
        <!-- å·¦ä¾§ç›®å½•æŒ‰é’® -->
        <div style="position: fixed; top: 20px; left: 20px; z-index: 1000;">
            <button id="toc-toggle" style="background-color: #f6f8fa; border: 1px solid #d0d7de; border-radius: 6px; padding: 8px 12px; cursor: pointer; font-size: 14px; transition: all 0.2s ease; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);" title="åˆ‡æ¢ç›®å½•">
                ç›®å½•
            </button>
        </div>
        
        <!-- å³ä¾§ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
        <div style="position: fixed; top: 20px; right: 20px; z-index: 1000;">
            <button id="theme-toggle" style="background-color: #f6f8fa; border: 1px solid #d0d7de; border-radius: 6px; padding: 8px 12px; cursor: pointer; font-size: 14px; transition: all 0.2s ease; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);" title="åˆ‡æ¢æ·±è‰²/æµ…è‰²æ¨¡å¼">æ·±è‰²</button>
        </div>
        
        <!-- ç›®å½•é¢æ¿ -->
        <div id="toc-panel" style="width: 280px; background-color: #f6f8fa; border-right: 1px solid #d0d7de; position: fixed; top: 0; left: -280px; height: 100vh; height: 100dvh; overflow-y: auto; transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 998; box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1); will-change: transform;">
            <div style="padding: 20px; padding-top: 60px; border-bottom: 1px solid #d0d7de;">
                <h3 style="font-size: 16px; font-weight: 600; margin: 0;">ç›®å½•</h3>
            </div>
            <div style="padding: 20px;">
                <ul id="toc-list" style="list-style: none; padding: 0; margin: 0;">
                    <!-- ç›®å½•å°†è‡ªåŠ¨ç”Ÿæˆ -->
                </ul>
            </div>
        </div>
        
        <div id="rendered-content"></div>
        
        <script>
            
            // é…ç½® Marked.js
            marked.setOptions({
                breaks: true,        // æ”¯æŒæ¢è¡Œ
                tables: true,        // æ”¯æŒè¡¨æ ¼
                gfm: true,          // æ”¯æŒGitHub Flavored Markdown
                headerIds: true,     // ç”Ÿæˆæ ‡é¢˜ID
                smartLists: true,    // æ™ºèƒ½åˆ—è¡¨
                smartypants: true,   // æ™ºèƒ½æ ‡ç‚¹
                xhtml: true,         // XHTMLå…¼å®¹
                mangle: false,       // ç¦ç”¨é‚®ç®±æ··æ·†
                sanitize: false      // ç¦ç”¨HTMLæ¸…ç†
            });
            
            var text = "";
            
            // ä¸»é¢˜ç®¡ç†
            class ThemeManager {
                constructor() {
                    this.init();
                }
                
                init() {
                    // ä»æœ¬åœ°å­˜å‚¨è·å–ä¸»é¢˜è®¾ç½®
                    const savedTheme = localStorage.getItem('theme');
                    const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    
                    // ç¡®å®šåˆå§‹ä¸»é¢˜
                    if (savedTheme) {
                        this.setTheme(savedTheme);
                    } else if (systemPrefersDark) {
                        this.setTheme('dark');
                    } else {
                        this.setTheme('light');
                    }
                    
                    // ç»‘å®šåˆ‡æ¢æŒ‰é’®äº‹ä»¶
                    const toggleButton = document.getElementById('theme-toggle');
                    toggleButton.addEventListener('click', () => this.toggleTheme());
                    
                    // ç›‘å¬ç³»ç»Ÿä¸»é¢˜å˜åŒ–
                    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                        if (!localStorage.getItem('theme')) {
                            this.setTheme(e.matches ? 'dark' : 'light');
                        }
                    });
                }
                
                setTheme(theme) {
                    const body = document.body;
                    const toggleButton = document.getElementById('theme-toggle');
                    
                    // ç§»é™¤æ‰€æœ‰ä¸»é¢˜ç±»
                    body.classList.remove('dark-mode', 'light-mode');
                    
                    if (theme === 'dark') {
                        body.classList.add('dark-mode');
                        toggleButton.textContent = 'æµ…è‰²';
                        toggleButton.title = 'åˆ‡æ¢åˆ°æµ…è‰²æ¨¡å¼';
                    } else {
                        body.classList.add('light-mode');
                        toggleButton.textContent = 'æ·±è‰²';
                        toggleButton.title = 'åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼';
                    }
                    
                    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                    localStorage.setItem('theme', theme);
                    this.currentTheme = theme;
                }
                
                toggleTheme() {
                    const newTheme = this.currentTheme === 'dark' ? 'light' : 'dark';
                    this.setTheme(newTheme);
                }
                
                getCurrentTheme() {
                    return this.currentTheme;
                }
            }
            
            // åˆå§‹åŒ–ä¸»é¢˜ç®¡ç†å™¨
            const themeManager = new ThemeManager();
            
            // ç›®å½•ç®¡ç†
            let tocOpen = false;
            
            // åˆå§‹åŒ–ç›®å½•åŠŸèƒ½
            function initTOC() {
                const toggleButton = document.getElementById('toc-toggle');
                const tocPanel = document.getElementById('toc-panel');
                
                // åˆ‡æ¢ç›®å½•æ˜¾ç¤º
                function toggleTOC() {
                    tocOpen = !tocOpen;
                    if (tocOpen) {
                        tocPanel.classList.add('open');
                    } else {
                        tocPanel.classList.remove('open');
                    }
                }
                
                // å…³é—­ç›®å½•
                function closeTOC() {
                    if (tocOpen) {
                        tocOpen = false;
                        tocPanel.classList.remove('open');
                    }
                }
                
                // ç»‘å®šåˆ‡æ¢æŒ‰é’®äº‹ä»¶ï¼ˆæ”¯æŒè§¦æ‘¸ï¼‰
                toggleButton.addEventListener('click', toggleTOC);
                toggleButton.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    toggleTOC();
                });
                
                // ç‚¹å‡»é¢æ¿å¤–åŒºåŸŸå…³é—­ç›®å½•ï¼ˆæ”¯æŒè§¦æ‘¸ï¼‰
                function handleOutsideClick(e) {
                    if (tocOpen && !e.target.closest('#toc-panel') && !e.target.closest('#toc-toggle')) {
                        closeTOC();
                    }
                }
                
                document.addEventListener('click', handleOutsideClick);
                document.addEventListener('touchend', handleOutsideClick);
                
                // æš´éœ²å…³é—­å‡½æ•°ä¾›ç›®å½•é“¾æ¥ä½¿ç”¨
                window.closeTOC = closeTOC;
            }
            
            // ç”Ÿæˆç›®å½•
            function generateTOC() {
                const headers = document.querySelectorAll('#rendered-content h1, #rendered-content h2, #rendered-content h3, #rendered-content h4, #rendered-content h5, #rendered-content h6');
                const tocList = document.getElementById('toc-list');
                
                if (headers.length === 0) {
                    tocList.innerHTML = '<li style="color: #666; padding: 12px; text-align: center;">æ— æ ‡é¢˜</li>';
                    return;
                }
                
                // æ¸…ç©ºç›®å½•å¹¶ç§»é™¤ä¹‹å‰çš„äº‹ä»¶ç›‘å¬å™¨
                tocList.innerHTML = '';
                
                // ä½¿ç”¨äº‹ä»¶å§”æ‰˜è€Œä¸æ˜¯ä¸ºæ¯ä¸ªé“¾æ¥æ·»åŠ ç›‘å¬å™¨
                const handleTocClick = (e) => {
                    const link = e.target.closest('a[data-target]');
                    if (link) {
                        e.preventDefault();
                        const targetId = link.getAttribute('data-target');
                        const element = document.getElementById(targetId);
                        if (element) {
                            // ä½¿ç”¨requestAnimationFrameç¡®ä¿å¹³æ»‘æ»šåŠ¨
                            const scrollToElement = () => {
                                try {
                                    element.scrollIntoView({ 
                                        behavior: 'smooth', 
                                        block: 'start' 
                                    });
                                } catch (err) {
                                    // é™çº§æ–¹æ¡ˆï¼šç›´æ¥æ»šåŠ¨
                                    element.scrollIntoView();
                                }
                            };
                            
                            requestAnimationFrame(scrollToElement);
                            
                            // åœ¨ç§»åŠ¨ç«¯ç‚¹å‡»åå…³é—­ç›®å½•
                            if (window.innerWidth <= 768) {
                                setTimeout(() => {
                                    if (window.closeTOC) window.closeTOC();
                                }, 300);
                            }
                        }
                    }
                };
                
                // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨å¹¶æ·»åŠ æ–°çš„
                tocList.removeEventListener('click', handleTocClick);
                tocList.addEventListener('click', handleTocClick);
                
                // ç”Ÿæˆç›®å½•é¡¹
                headers.forEach((header, index) => {
                    const level = parseInt(header.tagName.substring(1));
                    const text = header.textContent.trim();
                    
                    // ä¸ºæ ‡é¢˜æ·»åŠ IDï¼ˆå¦‚æœæ²¡æœ‰çš„è¯ï¼‰
                    if (!header.id) {
                        header.id = `heading-${index}`;
                    }
                    
                    const listItem = document.createElement('li');
                    listItem.style.margin = '4px 0';
                    
                    const link = document.createElement('a');
                    link.href = `#${header.id}`;
                    link.setAttribute('data-target', header.id);
                    link.textContent = text;
                    
                    // æ ¹æ®ä¸»é¢˜è®¾ç½®æ ·å¼
                    const isDarkMode = document.body.classList.contains('dark-mode');
                    const textColor = isDarkMode ? '#c9d1d9' : '#24292f';
                    
                    link.style.cssText = `
                        display: block;
                        padding: 6px 12px;
                        color: ${textColor};
                        text-decoration: none;
                        border-radius: 4px;
                        transition: background-color 0.2s ease;
                        font-size: 14px;
                        padding-left: ${12 + (level - 1) * 12}px;
                        ${level === 1 ? 'font-weight: 600;' : ''}
                        -webkit-tap-highlight-color: transparent;
                        touch-action: manipulation;
                    `;
                    
                    // ä½¿ç”¨CSS hoverè€Œä¸æ˜¯JavaScriptäº‹ä»¶ä»¥æå‡æ€§èƒ½
                    link.className = 'toc-link';
                    
                    listItem.appendChild(link);
                    tocList.appendChild(listItem);
                });
            }
            
            // å¤„ç†é“¾æ¥æ˜¾ç¤ºå’Œäº¤äº’
            function processLinks(element) {
                const links = element.querySelectorAll('a[href]');
                links.forEach(link => {
                    const href = link.getAttribute('href');
                    
                    if (!href) return;
                    
                    // ä¸ºå¤–é“¾æ·»åŠ å›¾æ ‡æ ‡è¯†
                    if (href.startsWith('http://') || href.startsWith('https://')) {
                        // å¤–é“¾å›¾æ ‡
                        if (!link.querySelector('.external-link-icon')) {
                            const icon = document.createElement('span');
                            icon.className = 'external-link-icon';
                            icon.innerHTML = ' â†—';
                            icon.style.cssText = 'font-size: 0.8em; opacity: 0.7; margin-left: 2px;';
                            link.appendChild(icon);
                        }
                    } else if (href.startsWith('mailto:')) {
                        // é‚®ä»¶é“¾æ¥å›¾æ ‡
                        if (!link.querySelector('.email-link-icon')) {
                            const icon = document.createElement('span');
                            icon.className = 'email-link-icon';
                            icon.innerHTML = ' âœ‰';
                            icon.style.cssText = 'font-size: 0.8em; opacity: 0.7; margin-left: 2px;';
                            link.appendChild(icon);
                        }
                    } else if (href.startsWith('tel:')) {
                        // ç”µè¯é“¾æ¥å›¾æ ‡
                        if (!link.querySelector('.phone-link-icon')) {
                            const icon = document.createElement('span');
                            icon.className = 'phone-link-icon';
                            icon.innerHTML = ' ğŸ“';
                            icon.style.cssText = 'font-size: 0.8em; opacity: 0.7; margin-left: 2px;';
                            link.appendChild(icon);
                        }
                    } else if (href.startsWith('#')) {
                        // é”šç‚¹é“¾æ¥ - æ·»åŠ ç‰¹æ®Šå¤„ç†ç¡®ä¿å¹³æ»‘æ»šåŠ¨
                        link.addEventListener('click', function(e) {
                            e.preventDefault();
                            const targetId = href.substring(1);
                            const targetElement = document.getElementById(targetId);
                            if (targetElement) {
                                try {
                                    targetElement.scrollIntoView({ 
                                        behavior: 'smooth', 
                                        block: 'start' 
                                    });
                                } catch (err) {
                                    // é™çº§æ–¹æ¡ˆ
                                    targetElement.scrollIntoView();
                                }
                            }
                        });
                    }
                });
            }
            
                                // æ·»åŠ å›¾ç‰‡ç‚¹å‡»æ”¾å¤§åŠŸèƒ½
            function addImageZoomFunction(element) {
                const images = element.querySelectorAll('img');
                images.forEach(img => {
                    // é¿å…é‡å¤æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    if (img.dataset.zoomEnabled) {
                        return;
                    }
                    
                    // æ ‡è®°å·²å¤„ç†
                    img.dataset.zoomEnabled = 'true';
                    
                    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                    img.addEventListener('click', function() {
                        showImageModal(this);
                    });
                });
            }
            
            // æ˜¾ç¤ºå›¾ç‰‡æ”¾å¤§æ¨¡æ€æ¡†
            function showImageModal(img) {
                // åˆ›å»ºæ¨¡æ€æ¡†
                const modal = document.createElement('div');
                modal.className = 'image-modal';
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0, 0, 0, 0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                    cursor: zoom-out;
                `;
                
                // åˆ›å»ºæ”¾å¤§çš„å›¾ç‰‡
                const modalImg = document.createElement('img');
                modalImg.src = img.src;
                modalImg.alt = img.alt;
                modalImg.style.cssText = `
                    max-width: 90%;
                    max-height: 90%;
                    object-fit: contain;
                    border-radius: 8px;
                    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                `;
                
                modal.appendChild(modalImg);
                
                // æ·»åŠ å…³é—­äº‹ä»¶
                modal.addEventListener('click', function() {
                    modal.remove();
                });
                
                // æ·»åŠ ESCé”®å…³é—­
                const handleEsc = function(e) {
                    if (e.key === 'Escape') {
                        modal.remove();
                        document.removeEventListener('keydown', handleEsc);
                    }
                };
                document.addEventListener('keydown', handleEsc);
                
                document.body.appendChild(modal);
            }
            
                                // æ·»åŠ ä»£ç å¤åˆ¶åŠŸèƒ½
            function addCodeCopyButtons(element) {
                const preElements = element.querySelectorAll('pre code');
                preElements.forEach(code => {
                    const pre = code.parentElement;
                    
                    // é¿å…é‡å¤æ·»åŠ æŒ‰é’®
                    if (pre.querySelector('.code-copy-button')) {
                        return;
                    }
                    
                    // åˆ›å»ºå¤åˆ¶æŒ‰é’®
                    const copyButton = document.createElement('button');
                    copyButton.className = 'code-copy-button';
                    copyButton.textContent = 'å¤åˆ¶';
                    copyButton.style.cssText = `
                        position: absolute;
                        top: 8px;
                        right: 8px;
                        background-color: #f6f8fa;
                        border: 1px solid #d0d7de;
                        border-radius: 4px;
                        padding: 4px 8px;
                        font-size: 12px;
                        cursor: pointer;
                        opacity: 0;
                        transition: opacity 0.2s ease;
                        z-index: 1;
                        font-family: inherit;
                    `;
                    
                    // è®¾ç½®preå…ƒç´ ä¸ºç›¸å¯¹å®šä½
                    pre.style.position = 'relative';
                    
                    // æ£€æŸ¥å½“å‰ä¸»é¢˜å¹¶åº”ç”¨ç›¸åº”æ ·å¼
                    const isDarkMode = document.body.classList.contains('dark-mode') || 
                                      (!document.body.classList.contains('light-mode') && 
                                       window.matchMedia('(prefers-color-scheme: dark)').matches);
                    
                    if (isDarkMode) {
                        copyButton.style.backgroundColor = '#21262d';
                        copyButton.style.color = '#c9d1d9';
                        copyButton.style.borderColor = '#30363d';
                    }
                    
                    // é¼ æ ‡æ‚¬åœæ˜¾ç¤ºæŒ‰é’®
                    pre.addEventListener('mouseenter', () => {
                        copyButton.style.opacity = '1';
                    });
                    
                    pre.addEventListener('mouseleave', () => {
                        copyButton.style.opacity = '0';
                    });
                    
                    // ç‚¹å‡»å¤åˆ¶
                    copyButton.addEventListener('click', async () => {
                        try {
                            await navigator.clipboard.writeText(code.textContent);
                            copyButton.textContent = 'å·²å¤åˆ¶';
                            setTimeout(() => {
                                copyButton.textContent = 'å¤åˆ¶';
                            }, 2000);
                        } catch (err) {
                            // é™çº§æ–¹æ¡ˆ
                            const textArea = document.createElement('textarea');
                            textArea.value = code.textContent;
                            document.body.appendChild(textArea);
                            textArea.select();
                            document.execCommand('copy');
                            document.body.removeChild(textArea);
                            copyButton.textContent = 'å·²å¤åˆ¶';
                            setTimeout(() => {
                                copyButton.textContent = 'å¤åˆ¶';
                            }, 2000);
                        }
                    });
                    
                    pre.appendChild(copyButton);
                });
            }
            
            // ä¼˜åŒ–ä»»åŠ¡åˆ—è¡¨æ ·å¼
            function enhanceTaskLists(element) {
                const taskItems = element.querySelectorAll('li');
                taskItems.forEach(item => {
                    const text = item.innerHTML;
                    // æ£€æŸ¥æ˜¯å¦ä¸ºä»»åŠ¡åˆ—è¡¨é¡¹
                    if (text.includes('â˜') || text.includes('â˜‘') || text.includes('âœ“') || 
                        text.includes('[ ]') || text.includes('[x]') || text.includes('[X]')) {
                        
                        // æ›¿æ¢ä»»åŠ¡åˆ—è¡¨æ ‡è®°
                        let newText = text
                            .replace(/â˜|â˜‘|âœ“|\[[ ]\]|\[x\]|\[X\]/g, (match) => {
                                const isChecked = match === 'â˜‘' || match === 'âœ“' || match === '[x]' || match === '[X]';
                                return `<input type="checkbox" ${isChecked ? 'checked' : ''} disabled style="margin-right: 8px;">`;
                            });
                        
                        item.innerHTML = newText;
                        item.style.listStyle = 'none';
                        item.style.marginLeft = '-20px';
                        
                        // å¦‚æœå·²å®Œæˆï¼Œæ·»åŠ åˆ é™¤çº¿æ ·å¼
                        if (text.includes('â˜‘') || text.includes('âœ“') || text.includes('[x]') || text.includes('[X]')) {
                            item.style.textDecoration = 'line-through';
                            item.style.opacity = '0.7';
                        }
                    }
                });
            }
            
            // æ¸²æŸ“å‡½æ•°
            function renderMarkdown(markdownText) {
                try {
                    // ç›´æ¥æ¸²æŸ“å®Œæ•´çš„Markdownå†…å®¹
                    text = markdownText;
                    const html = marked.parse(text);
                    const contentElement = document.getElementById('rendered-content');
                    
                    if (!contentElement) {
                        console.error('æœªæ‰¾åˆ°å†…å®¹å®¹å™¨å…ƒç´ ');
                        return;
                    }
                    
                    contentElement.innerHTML = html;
                    
                    // ä½¿ç”¨requestAnimationFrameç¡®ä¿DOMæ›´æ–°åå†å¤„ç†å¢å¼ºåŠŸèƒ½
                    requestAnimationFrame(() => {
                        try {
                            // å¤„ç†é“¾æ¥æ˜¾ç¤ºå’Œäº¤äº’
                            processLinks(contentElement);
                            
                            // æ·»åŠ å›¾ç‰‡ç‚¹å‡»æ”¾å¤§åŠŸèƒ½
                            addImageZoomFunction(contentElement);
                            
                            // æ·»åŠ ä»£ç å¤åˆ¶åŠŸèƒ½
                            addCodeCopyButtons(contentElement);
                            
                            // ä¼˜åŒ–ä»»åŠ¡åˆ—è¡¨æ ·å¼
                            enhanceTaskLists(contentElement);
                            
                            // ç”Ÿæˆç›®å½•
                            generateTOC();
                        } catch (error) {
                            console.error('å¢å¼ºåŠŸèƒ½å¤„ç†é”™è¯¯:', error);
                        }
                    });
                    
                    // æ¸²æŸ“æ•°å­¦å…¬å¼
                    if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) {
                        MathJax.typesetPromise([contentElement])
                            .then(() => {
                                console.log('MathJaxæ¸²æŸ“å®Œæˆ');
                            })
                            .catch((err) => {
                                console.error('MathJaxæ¸²æŸ“é”™è¯¯:', err);
                            });
                    }
                        
                } catch (error) {
                    console.error('Markdownæ¸²æŸ“é”™è¯¯:', error);
                    const contentElement = document.getElementById('rendered-content');
                    if (contentElement) {
                        contentElement.innerHTML = 
                            '<div style="color: red; padding: 20px;">æ¸²æŸ“é”™è¯¯: ' + error.message + '</div>';
                    }
                }
            }
            
            // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
            document.addEventListener('DOMContentLoaded', () => {
                try {
                    initTOC();
                    
                    // æ£€æŸ¥viewportè®¾ç½®ï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–æé†’ï¼‰
                    const viewport = document.querySelector('meta[name="viewport"]');
                    if (!viewport || !viewport.content.includes('width=device-width')) {
                        console.warn('å»ºè®®æ·»åŠ viewport metaæ ‡ç­¾ä»¥ä¼˜åŒ–ç§»åŠ¨ç«¯æ˜¾ç¤º');
                    }
                } catch (error) {
                    console.error('åˆå§‹åŒ–é”™è¯¯:', error);
                }
            });
            
            // æš´éœ²ç»™å®¢æˆ·ç«¯è°ƒç”¨
            window.renderMarkdown = renderMarkdown;
        </script>
        
    </body>
</html>
